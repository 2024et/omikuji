<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>おみくじ会場</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="icon.ico">
</head>
<body>
    <h1>おみくじ会場</h1>
    <h2>やり方</h2>
    <p>1.下のボタンを押してね！</p>
    <p>2.スマホを振ってみよう！すると、おみくじ箱も一緒に揺れるよ！</p>
    <p>3.少しすると、結果が表示されるよ！</p>
    <div class="div-center">
        <button onclick="requestPermission()" class="btn">このボタンを最初に押してね！</button>
    </div>
    
    <br><br>

    <div class="div-center">
        <img src="kuji.png" class="imageIrust" id="shakeImage" alt="おみくじのイラスト">
    </div>

    
    <script>
        //権限の許可
        let lastTime = 0;

        function requestPermission() {
            if (
                typeof DeviceMotionEvent !== "undefined" &&
                typeof DeviceMotionEvent.requestPermission === "function"
            ) {
                DeviceMotionEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === "granted") {
                    window.addEventListener("devicemotion", handleMotion);
                    
                    }
                })
                .catch(console.error);
            } else {
                window.addEventListener("devicemotion", handleMotion);
                
            }
            alert("ボタンを押してくれてありがとう！早速、スマホを振ってみよう！");
        }

        //振動判定
        function handleMotion(event) {
        const acc = event.accelerationIncludingGravity;
        if (!acc) return;

        const x = acc.x || 0;
        const y = acc.y || 0;
        const z = acc.z || 0;

        const power = Math.sqrt(x * x + y * y + z * z);

        const now = Date.now();

        if (power > 25 && now - lastTime > 1000) {
            lastTime = now;
            document.getElementById("shakeImage").classList.add("shake");
            setTimeout(() => {
                window.location.href = "result.html";
            }, 2000); 
        }
        }
    </script>
</body>
</html>